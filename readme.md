# Banded Krait

**Banded Krait** — это скрипт для автоматизации процесса резервного копирования и записи бэкапов на ленту с использованием pgbackrest. Он работает с несколькими регионами, перемещая бэкапы на центральное хранилище и затем записывая их на ленту. Скрипт отслеживает статус каждого процесса и взаимодействует с системой мониторинга Zabbix.

## Описание процесса

Процесс резервного копирования состоит из трех этапов:

1. **Резервное копирование PostgreSQL** с помощью pgbackrest.
2. **Перемещение бэкапов** с репозитория на центральное хранилище с использованием rsync.
3. **Запись на ленту** с центрального хранилища на ленту, с автоматической обработкой очереди бэкапов.

### Этапы:

1. **Резервное копирование:** 
   Скрипт запускается через `cron` на сервере репозитория, выполняет полный или дифференциальный бэкап базы данных с использованием pgbackrest. Статус каждого бэкапа фиксируется в базе данных PostgreSQL.
   
2. **Копирование на центральное хранилище:** 
   После успешного завершения бэкапа, другой скрипт с использованием `rsync` копирует бэкап в центральное хранилище с регистрацией статуса копирования.
   
3. **Запись на ленту:** 
   Скрипт на центральном сервере (pautina-backup) проверяет статус бэкапов и запускает запись на ленту. 
   Скрипт избегает дублирования и ошибок при записи.